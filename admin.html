<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Portal - UCC</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-brand">
            <h1>UCC Admin Portal</h1>
            <span class="badge badge-danger">ADMIN</span>
        </div>
        <div class="nav-menu">
            <a href="#dashboard" class="nav-link active">Dashboard</a>
            <a href="#halls" class="nav-link">Lecture Halls</a>
            <a href="#rooms" class="nav-link">Rooms</a>
            <a href="#unavailable" class="nav-link">Unavailability</a>
        </div>
        <div class="nav-user">
            <span id="userName">Admin</span>
            <button id="logoutBtn" class="btn btn-secondary">Logout</button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Dashboard View -->
        <section id="dashboardView" class="view active">
            <div class="dashboard-header">
                <h2>Admin Dashboard</h2>
            </div>

            <div class="dashboard-grid">
                <!-- Statistics -->
                <div class="card">
                    <h3>Overview</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-value" id="totalHalls">0</span>
                            <span class="stat-label">Lecture Halls</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="totalRooms">0</span>
                            <span class="stat-label">Rooms</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="totalUsers">0</span>
                            <span class="stat-label">Users</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="totalBookings">0</span>
                            <span class="stat-label">Bookings</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card">
                    <h3>Quick Actions</h3>
                    <div class="action-buttons">
                        <button class="btn btn-primary" id="addHallBtn">Add Lecture Hall</button>
                        <button class="btn btn-primary" id="addRoomBtn">Add Room</button>
                        <button class="btn btn-secondary" id="viewBookingsBtn">View All Bookings</button>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="card full-width">
                    <h3>Recent Activity</h3>
                    <div id="recentActivity" class="activity-list">
                        <p class="loading">Loading...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Lecture Halls View -->
        <section id="hallsView" class="view">
            <div class="view-header">
                <h2>Lecture Halls</h2>
                <button class="btn btn-primary" id="newHallBtn">Add New Hall</button>
            </div>
            <div id="hallsList" class="items-grid">
                <p class="loading">Loading...</p>
            </div>
        </section>

        <!-- Rooms View -->
        <section id="roomsView" class="view">
            <div class="view-header">
                <h2>Rooms</h2>
                <div class="view-controls">
                    <select id="filterHall" class="filter-select">
                        <option value="">All Halls</option>
                    </select>
                    <button class="btn btn-secondary" id="bulkAddRoomsBtn">Bulk Add Rooms</button>
                    <button class="btn btn-primary" id="newRoomBtn">Add New Room</button>
                </div>
            </div>
            <div id="roomsList" class="items-grid">
                <p class="loading">Loading...</p>
            </div>
        </section>

        <!-- Unavailability View -->
        <section id="unavailableView" class="view">
            <div class="view-header">
                <h2>Room Unavailability Management</h2>
                <button class="btn btn-primary" id="newUnavailabilityBtn">Mark Room Unavailable</button>
            </div>
            <div id="unavailabilityList" class="items-list">
                <p class="loading">Loading...</p>
            </div>
        </section>
    </main>

    <!-- Add/Edit Lecture Hall Modal -->
    <div id="hallModal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2 id="hallModalTitle">Add Lecture Hall</h2>
            <form id="hallForm">
                <div class="form-group">
                    <label for="hallName">Hall Name</label>
                    <input type="text" id="hallName" required placeholder="e.g., Engineering Block A">
                </div>
                <div class="form-group">
                    <label for="hallLocation">Location</label>
                    <input type="text" id="hallLocation" required placeholder="e.g., North Campus">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary modal-cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Hall</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add/Edit Room Modal -->
    <div id="roomModal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2 id="roomModalTitle">Add Room</h2>
            <form id="roomForm">
                <div class="form-group">
                    <label for="roomHall">Lecture Hall</label>
                    <select id="roomHall" required>
                        <option value="">Select Hall...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="roomNumber">Room Number/Name</label>
                    <input type="text" id="roomNumber" required placeholder="e.g., Room 5 or Lab A">
                </div>
                <div class="form-group">
                    <label for="roomCapacity">Capacity (Number of Seats)</label>
                    <input type="number" id="roomCapacity" required min="1" placeholder="e.g., 50">
                </div>
                <div class="form-section">
                    <h3>Room Features</h3>
                    <div class="form-group">
                        <label for="workingSockets">Working Electricity Sockets</label>
                        <input type="number" id="workingSockets" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="hasProjector">
                            Has Working Projector
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="hasMicSpeaker">
                            Has PA System / Mic & Speaker
                        </label>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary modal-cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Room</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bulk Add Rooms Modal -->
    <div id="bulkRoomModal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2>Bulk Add Rooms</h2>
            <form id="bulkRoomForm">
                <div class="form-group">
                    <label for="bulkRoomHall">Lecture Hall</label>
                    <select id="bulkRoomHall" required>
                        <option value="">Select Hall...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="roomPrefix">Room Name Prefix</label>
                    <input type="text" id="roomPrefix" required placeholder="e.g., SLT">
                    <small style="color: #666; margin-top: 0.25rem; display: block;">
                        Auto-generated from hall name. Edit if needed.
                    </small>
                </div>
                <div class="form-group">
                    <label>Room Numbers</label>
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <input type="number" id="roomStartNum" required min="1" placeholder="Start" style="flex: 1;">
                        <span>to</span>
                        <input type="number" id="roomEndNum" required min="1" placeholder="End" style="flex: 1;">
                    </div>
                    <small style="color: #666; margin-top: 0.25rem; display: block;">
                        E.g., 1 to 10 will create: SLT 1, SLT 2, ..., SLT 10
                    </small>
                </div>
                <div class="form-section">
                    <h3>Default Properties (Applied to all rooms)</h3>
                    <div class="form-group">
                        <label for="bulkRoomCapacity">Capacity (Number of Seats)</label>
                        <input type="number" id="bulkRoomCapacity" required min="1" placeholder="e.g., 50">
                    </div>
                    <div class="form-group">
                        <label for="bulkWorkingSockets">Working Electricity Sockets</label>
                        <input type="number" id="bulkWorkingSockets" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="bulkHasProjector">
                            Has Working Projector
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="bulkHasMicSpeaker">
                            Has PA System / Mic & Speaker
                        </label>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary modal-cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Rooms</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Unavailability Modal -->
    <div id="unavailabilityModal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2>Mark Room as Unavailable</h2>
            <form id="unavailabilityForm">
                <div class="form-group">
                    <label for="unavailHall">Lecture Hall</label>
                    <select id="unavailHall" required>
                        <option value="">Select Hall...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="unavailRoom">Room</label>
                    <select id="unavailRoom" required disabled>
                        <option value="">Select Hall First...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Unavailability Type</label>
                    <label>
                        <input type="radio" name="unavailType" value="date" checked>
                        Specific Date
                    </label>
                    <label>
                        <input type="radio" name="unavailType" value="recurring">
                        Recurring (Every Week)
                    </label>
                </div>
                <div class="form-group" id="specificDateField">
                    <label for="unavailDate">Date</label>
                    <input type="date" id="unavailDate" required>
                </div>
                <div class="form-group hidden" id="recurringDayField">
                    <label for="unavailDay">Day of Week</label>
                    <select id="unavailDay">
                        <option value="1">Monday</option>
                        <option value="2">Tuesday</option>
                        <option value="3">Wednesday</option>
                        <option value="4">Thursday</option>
                        <option value="5">Friday</option>
                        <option value="6">Saturday</option>
                        <option value="7">Sunday</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="unavailStart">Start Time</label>
                        <input type="time" id="unavailStart" required>
                    </div>
                    <div class="form-group">
                        <label for="unavailEnd">End Time</label>
                        <input type="time" id="unavailEnd" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="unavailReason">Reason</label>
                    <select id="unavailReason" required>
                        <option value="maintenance">Maintenance</option>
                        <option value="cleaning">Cleaning</option>
                        <option value="student_study">Free for Student Study</option>
                        <option value="closed">Completely Closed</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="unavailMessage">Custom Message (Optional)</label>
                    <input type="text" id="unavailMessage" placeholder="e.g., Under renovation">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary modal-cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content modal-small">
            <h2>Confirm Deletion</h2>
            <p id="deleteMessage">Are you sure you want to delete this item?</p>
            <div class="form-actions">
                <button class="btn btn-secondary" id="cancelDeleteBtn">Cancel</button>
                <button class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/12.9.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.9.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore-compat.js"></script>

    <!-- Application Scripts -->
    <script type="module" src="js/firebase-config.js"></script>
    <script type="module" src="js/utils/dateUtils.js"></script>
    <script type="module" src="js/services/roomService.js"></script>
    <script type="module" src="js/services/bookingService.js"></script>
    <script type="module" src="js/services/userService.js"></script>
    <script type="module" src="js/components/Modal.js"></script>
    <script type="module" src="js/components/Toast.js"></script>
    <script type="module" src="js/router.js"></script>
    <script type="module" src="js/admin.js"></script>
    <script type="module" src="js/app.js"></script>

    <script type="module">
        // Admin-specific initialization
        import { checkAuth } from './js/auth.js';
        
        // Verify user is authenticated and is admin
        checkAuth('admin').then((userData) => {
            console.log('Admin authenticated:', userData);
            // User is admin, page will load normally
        }).catch(() => {
            // Not admin or not logged in, redirect to login
            console.log('Not admin, redirecting...');
            window.location.href = '/index.html';
        });
    </script>
</body>
</html>
